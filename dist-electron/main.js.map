{"version":3,"file":"main.js","sources":["../electron/database/sample-data.ts","../electron/database/init.ts","../electron/mcp-server.ts","../electron/database/queries.ts","../electron/main.ts"],"sourcesContent":["import type { CreateCategoryData, CreateTemplateData, CreatePromptData } from '../../src/types'\n\nexport const sampleCategories: CreateCategoryData[] = [\n  { name: 'General', description: 'General purpose prompts for various tasks', color: '#6366f1' },\n  { name: 'Creative Writing', description: 'Prompts for creative writing, storytelling, and content creation', color: '#ec4899' },\n  { name: 'Code Generation', description: 'Programming, debugging, and code-related prompts', color: '#10b981' },\n  { name: 'Analysis', description: 'Data analysis, research, and analytical thinking prompts', color: '#f59e0b' },\n  { name: 'Business', description: 'Business strategy, marketing, and professional communication', color: '#8b5cf6' },\n  { name: 'Education', description: 'Learning, teaching, and educational content prompts', color: '#06b6d4' },\n  { name: 'Personal', description: 'Personal development, productivity, and lifestyle prompts', color: '#ef4444' },\n]\n\nexport const sampleTemplates: CreateTemplateData[] = [\n  {\n    name: 'Code Review Template',\n    description: 'Comprehensive code review with focus areas',\n    content: `Please review the following {{language}} code and provide feedback:\n\n\\`\\`\\`{{language}}\n{{code}}\n\\`\\`\\`\n\nFocus on:\n- Code quality and readability\n- Performance optimizations\n- Security considerations\n- Best practices for {{language}}\n- Potential bugs or issues\n\nPlease provide specific suggestions for improvement.`,\n    variables: ['language', 'code'],\n    category_id: 3\n  },\n  {\n    name: 'Blog Post Outline',\n    description: 'Structure for creating engaging blog posts',\n    content: `Create a detailed blog post outline for: \"{{title}}\"\n\nTarget audience: {{audience}}\nTone: {{tone}}\nWord count: {{wordCount}} words\n\nInclude:\n1. Compelling headline variations (3-5 options)\n2. Introduction hook\n3. Main sections with subheadings\n4. Key points for each section\n5. Call-to-action ideas\n6. SEO considerations\n\nMake it engaging and actionable for the {{audience}} audience.`,\n    variables: ['title', 'audience', 'tone', 'wordCount'],\n    category_id: 2\n  },\n  {\n    name: 'Data Analysis Framework',\n    description: 'Structured approach for data analysis tasks',\n    content: `Analyze the following {{dataType}} data:\n\n{{dataDescription}}\n\nPlease provide:\n1. Data overview and quality assessment\n2. Key patterns and trends identified\n3. Statistical insights and correlations\n4. {{analysisType}} analysis\n5. Actionable recommendations\n6. Potential limitations and caveats\n\nPresent findings in a clear, business-friendly format with supporting visualizations suggestions.`,\n    variables: ['dataType', 'dataDescription', 'analysisType'],\n    category_id: 4\n  },\n  {\n    name: 'Learning Plan Creator',\n    description: 'Personalized learning roadmap template',\n    content: `Create a comprehensive learning plan for: {{subject}}\n\nLearner profile:\n- Current level: {{currentLevel}}\n- Available time: {{timeCommitment}} per week\n- Learning style: {{learningStyle}}\n- Goal: {{goal}}\n\nInclude:\n1. Learning objectives and milestones\n2. Week-by-week study plan\n3. Recommended resources (books, courses, tutorials)\n4. Practice exercises and projects\n5. Assessment methods\n6. Troubleshooting common challenges\n\nMake it practical and achievable within the specified timeframe.`,\n    variables: ['subject', 'currentLevel', 'timeCommitment', 'learningStyle', 'goal'],\n    category_id: 6\n  },\n  {\n    name: 'Meeting Summary Template',\n    description: 'Professional meeting notes and action items',\n    content: `Summarize the following meeting content:\n\nMeeting: {{meetingTitle}}\nDate: {{date}}\nParticipants: {{participants}}\n\nMeeting notes:\n{{meetingNotes}}\n\nPlease provide:\n1. Executive summary (2-3 sentences)\n2. Key decisions made\n3. Action items with owners and deadlines\n4. Open questions and next steps\n5. Follow-up meeting requirements\n\nFormat for easy sharing with stakeholders.`,\n    variables: ['meetingTitle', 'date', 'participants', 'meetingNotes'],\n    category_id: 5\n  }\n]\n\nexport const samplePrompts: CreatePromptData[] = [\n  // Creative Writing Prompts\n  {\n    title: 'Character Development Helper',\n    content: `Help me create a compelling character for my story. Ask me questions about their background, motivations, fears, and goals. Then provide a detailed character profile including:\n\n- Physical description\n- Personality traits and quirks\n- Backstory and formative experiences\n- Internal conflicts and growth arc\n- Relationships with other characters\n- Dialogue style and speech patterns\n\nMake the character feel authentic and three-dimensional.`,\n    description: 'Interactive character creation for fiction writing',\n    category_id: 2,\n    tags: ['writing', 'characters', 'fiction', 'creativity'],\n    is_favorite: true\n  },\n  {\n    title: 'Story Twist Generator',\n    content: `I'm writing a {{genre}} story and need help creating an unexpected plot twist. Here's my current plot:\n\n{{plotSummary}}\n\nThe twist should:\n- Be surprising but logical in hindsight\n- Connect to earlier story elements\n- Raise the stakes for the protagonist\n- Feel organic to the story world\n\nPlease suggest 3 different twist options with brief explanations of how to foreshadow them earlier in the story.`,\n    description: 'Generate surprising plot twists for stories',\n    category_id: 2,\n    template_id: null,\n    tags: ['writing', 'plot', 'storytelling', 'creativity', 'fiction'],\n    is_favorite: false\n  },\n\n  // Code Generation Prompts\n  {\n    title: 'API Endpoint Creator',\n    content: `Create a RESTful API endpoint for {{resource}} with the following requirements:\n\nFramework: {{framework}}\nDatabase: {{database}}\nAuthentication: {{authType}}\n\nInclude:\n- Route definitions with proper HTTP methods\n- Request/response schemas\n- Input validation\n- Error handling\n- Database queries\n- Authentication middleware\n- Unit tests\n- API documentation\n\nFollow best practices for security, performance, and maintainability.`,\n    description: 'Generate complete API endpoints with tests and documentation',\n    category_id: 3,\n    tags: ['api', 'backend', 'rest', 'database', 'authentication'],\n    is_favorite: true\n  },\n  {\n    title: 'Algorithm Optimization',\n    content: `Analyze and optimize this algorithm for better performance:\n\n\\`\\`\\`python\n{{algorithm}}\n\\`\\`\\`\n\nCurrent time complexity: {{currentComplexity}}\nTarget improvement: {{targetImprovement}}\n\nPlease provide:\n1. Complexity analysis of the current implementation\n2. Bottlenecks and performance issues identified\n3. Optimized version with explanations\n4. New time/space complexity analysis\n5. Benchmarking suggestions\n6. Alternative approaches if applicable\n\nInclude code examples and explain the optimization techniques used.`,\n    description: 'Analyze and improve algorithm performance',\n    category_id: 3,\n    tags: ['algorithms', 'optimization', 'performance', 'python', 'complexity'],\n    is_favorite: false\n  },\n\n  // Analysis Prompts\n  {\n    title: 'Market Research Analyzer',\n    content: `Conduct a comprehensive market analysis for {{industry}} focusing on {{targetMarket}}.\n\nResearch areas:\n- Market size and growth trends\n- Key competitors and their positioning\n- Customer segments and personas\n- Pricing strategies and models\n- Emerging opportunities and threats\n- Technology disruptions\n- Regulatory considerations\n\nProvide actionable insights and strategic recommendations for entering or expanding in this market.`,\n    description: 'Comprehensive market research and competitive analysis',\n    category_id: 4,\n    tags: ['market-research', 'analysis', 'business', 'strategy', 'competitors'],\n    is_favorite: true\n  },\n  {\n    title: 'Data Visualization Consultant',\n    content: `I have a dataset with the following characteristics:\n- Data type: {{dataType}}\n- Size: {{dataSize}}\n- Key variables: {{variables}}\n- Business question: {{businessQuestion}}\n\nRecommend the best visualization types and create:\n1. Appropriate chart types for each variable\n2. Dashboard layout suggestions\n3. Color schemes and styling guidelines\n4. Interactive features to include\n5. Key insights to highlight\n6. Tools/libraries recommendations\n\nFocus on clarity, accuracy, and business impact.`,\n    description: 'Expert advice on data visualization and dashboard design',\n    category_id: 4,\n    tags: ['data-viz', 'charts', 'dashboard', 'analytics', 'insights'],\n    is_favorite: false\n  },\n\n  // Business Prompts\n  {\n    title: 'Email Campaign Writer',\n    content: `Create a professional email campaign for {{campaignType}}:\n\nTarget audience: {{audience}}\nGoal: {{goal}}\nTone: {{tone}}\nIndustry: {{industry}}\n\nInclude:\n- Compelling subject line (5 variations)\n- Email body with clear structure\n- Strong call-to-action\n- Follow-up sequence (3 emails)\n- A/B testing suggestions\n- Performance metrics to track\n\nEnsure compliance with email marketing best practices and regulations.`,\n    description: 'Professional email marketing campaign creation',\n    category_id: 5,\n    tags: ['email', 'marketing', 'copywriting', 'campaigns', 'business'],\n    is_favorite: true\n  },\n  {\n    title: 'Business Plan Reviewer',\n    content: `Review my business plan and provide detailed feedback:\n\n{{businessPlan}}\n\nEvaluate:\n- Executive summary clarity and impact\n- Market analysis depth and accuracy\n- Financial projections realism\n- Marketing strategy effectiveness\n- Operations plan feasibility\n- Risk assessment completeness\n- Funding requirements justification\n\nProvide specific improvement suggestions and highlight strengths and weaknesses.`,\n    description: 'Comprehensive business plan analysis and feedback',\n    category_id: 5,\n    tags: ['business-plan', 'strategy', 'analysis', 'feedback', 'entrepreneurship'],\n    is_favorite: false\n  },\n\n  // Education Prompts\n  {\n    title: 'Lesson Plan Creator',\n    content: `Create an engaging lesson plan for {{subject}} targeting {{gradeLevel}} students.\n\nTopic: {{topic}}\nDuration: {{duration}}\nLearning objectives: {{objectives}}\n\nInclude:\n- Learning objectives (specific, measurable)\n- Materials and resources needed\n- Step-by-step activity breakdown\n- Assessment methods\n- Differentiation strategies\n- Extension activities for advanced learners\n- Homework assignments\n- Reflection questions\n\nMake it interactive and aligned with educational standards.`,\n    description: 'Comprehensive lesson plan with activities and assessments',\n    category_id: 6,\n    tags: ['education', 'lesson-plan', 'teaching', 'learning', 'curriculum'],\n    is_favorite: true\n  },\n  {\n    title: 'Study Guide Generator',\n    content: `Create a comprehensive study guide for {{subject}} focusing on {{topics}}.\n\nFormat for {{learningStyle}} learners.\nExam date: {{examDate}}\nAvailable study time: {{studyTime}}\n\nInclude:\n- Key concepts and definitions\n- Summary of main topics\n- Practice questions with answers\n- Memory aids and mnemonics\n- Study schedule breakdown\n- Review checklists\n- Common mistakes to avoid\n- Additional resources\n\nMake it practical and exam-focused.`,\n    description: 'Personalized study guides for exam preparation',\n    category_id: 6,\n    tags: ['study-guide', 'exam-prep', 'learning', 'education', 'memory'],\n    is_favorite: false\n  },\n\n  // Personal Development Prompts\n  {\n    title: 'Goal Setting Coach',\n    content: `Help me set and plan actionable goals for {{timeframe}}.\n\nCurrent situation: {{currentSituation}}\nDesired outcomes: {{desiredOutcomes}}\nConstraints: {{constraints}}\n\nProvide:\n- SMART goal formulation\n- Milestone breakdown\n- Action plan with deadlines\n- Potential obstacles and solutions\n- Success metrics and tracking methods\n- Accountability strategies\n- Motivation techniques\n- Weekly review framework\n\nMake it realistic and achievable.`,\n    description: 'Personal goal setting and achievement planning',\n    category_id: 7,\n    tags: ['goals', 'planning', 'productivity', 'personal-development', 'motivation'],\n    is_favorite: true\n  },\n  {\n    title: 'Habit Formation Guide',\n    content: `Help me build a lasting habit around {{habitDescription}}.\n\nCurrent routine: {{currentRoutine}}\nAvailable time: {{availableTime}}\nMotivation level: {{motivationLevel}}\nPast challenges: {{pastChallenges}}\n\nCreate a plan including:\n- Habit stacking opportunities\n- Environmental design suggestions\n- Reward system setup\n- Progress tracking methods\n- Overcoming common obstacles\n- Weekly habit review process\n- Long-term maintenance strategies\n\nUse proven behavioral science principles.`,\n    description: 'Science-based habit formation and maintenance strategies',\n    category_id: 7,\n    tags: ['habits', 'behavior', 'personal-development', 'routine', 'psychology'],\n    is_favorite: false\n  },\n\n  // General Purpose Prompts\n  {\n    title: 'Decision Making Framework',\n    content: `Help me make a well-informed decision about {{decision}}.\n\nContext: {{context}}\nOptions: {{options}}\nConstraints: {{constraints}}\nTimeline: {{timeline}}\n\nApply a structured decision-making process:\n1. Clarify objectives and criteria\n2. Evaluate pros and cons of each option\n3. Risk assessment for each choice\n4. Stakeholder impact analysis\n5. Cost-benefit analysis\n6. Implementation considerations\n7. Contingency planning\n8. Final recommendation with reasoning\n\nProvide an objective, analytical perspective.`,\n    description: 'Structured approach to important decision making',\n    category_id: 1,\n    tags: ['decision-making', 'analysis', 'strategy', 'planning', 'framework'],\n    is_favorite: true\n  },\n  {\n    title: 'Problem Solving Assistant',\n    content: `I'm facing this problem: {{problemDescription}}\n\nContext and background: {{context}}\nWhat I've tried so far: {{attemptedSolutions}}\nConstraints: {{constraints}}\n\nHelp me solve it using:\n1. Problem definition and root cause analysis\n2. Creative brainstorming techniques\n3. Solution evaluation criteria\n4. Step-by-step implementation plan\n5. Risk mitigation strategies\n6. Success measurement methods\n7. Alternative approaches if first solution fails\n\nThink systematically and creatively.`,\n    description: 'Systematic problem-solving using proven methodologies',\n    category_id: 1,\n    tags: ['problem-solving', 'analysis', 'creativity', 'planning', 'methodology'],\n    is_favorite: false\n  }\n]\n\n// Map category names to IDs for template and prompt assignments\nexport function assignCategoryIds(categories: any[], templates: CreateTemplateData[], prompts: CreatePromptData[]) {\n  const categoryMap = new Map(categories.map((cat, index) => [cat.name, index + 1]))\n  \n  // Update templates\n  templates.forEach(template => {\n    if (template.category_id && template.category_id <= categories.length) {\n      template.category_id = categoryMap.get(categories[template.category_id - 1].name) || template.category_id\n    }\n  })\n  \n  // Update prompts\n  prompts.forEach(prompt => {\n    if (prompt.category_id && prompt.category_id <= categories.length) {\n      prompt.category_id = categoryMap.get(categories[prompt.category_id - 1].name) || prompt.category_id\n    }\n  })\n}","import sqlite3, { Database } from 'sqlite3'\nimport { join } from 'path'\nimport { existsSync, mkdirSync } from 'fs'\nimport { app } from 'electron'\nimport { sampleCategories, sampleTemplates, samplePrompts, assignCategoryIds } from './sample-data'\n\nlet database: Database | null = null\n\nexport const getDatabasePath = (): string => {\n  const userDataPath = app.getPath('userData')\n  if (!existsSync(userDataPath)) {\n    mkdirSync(userDataPath, { recursive: true })\n  }\n  const dbPath = join(userDataPath, 'prompt-studio.db')\n  return dbPath\n}\n\nexport const initDatabase = (): Promise<Database> => {\n  return new Promise((resolve, reject) => {\n    if (database) {\n      return resolve(database)\n    }\n\n    const dbPath = getDatabasePath()\n\n    database = new sqlite3.Database(dbPath, (err) => {\n      if (err) {\n        console.error('Error opening database:', err)\n        return reject(err)\n      }\n      \n      // Enable WAL mode for better concurrency and durability\n      database!.run('PRAGMA journal_mode=WAL;', (pragmaErr) => {\n        if (pragmaErr) {\n          console.warn('Could not enable WAL mode:', pragmaErr)\n        }\n        \n        // Enable foreign keys\n        database!.run('PRAGMA foreign_keys=ON;', (fkErr) => {\n          if (fkErr) {\n            console.warn('Could not enable foreign keys:', fkErr)\n          }\n          \n          // Set synchronous mode to FULL for data integrity\n          database!.run('PRAGMA synchronous=FULL;', (syncErr) => {\n            if (syncErr) {\n              console.warn('Could not set synchronous mode:', syncErr)\n            }\n            \n            createTables()\n              .then(() => resolve(database!))\n              .catch(reject)\n          })\n        })\n      })\n    })\n  })\n}\n\nconst createTables = (): Promise<void> => {\n  return new Promise((resolve, reject) => {\n    if (!database) return reject(new Error('Database not initialized'))\n\n    const tables = [\n      // Settings table\n      `CREATE TABLE IF NOT EXISTS settings (\n        key TEXT PRIMARY KEY,\n        value TEXT,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n      )`,\n\n      // Categories table\n      `CREATE TABLE IF NOT EXISTS categories (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        name TEXT NOT NULL UNIQUE,\n        description TEXT,\n        color TEXT DEFAULT '#007acc',\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n      )`,\n\n      // Templates table\n      `CREATE TABLE IF NOT EXISTS templates (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        name TEXT NOT NULL,\n        description TEXT,\n        content TEXT NOT NULL,\n        variables TEXT, -- JSON array of variable names\n        category_id INTEGER,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        FOREIGN KEY (category_id) REFERENCES categories (id)\n      )`,\n\n      // Prompts table\n      `CREATE TABLE IF NOT EXISTS prompts (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        title TEXT NOT NULL,\n        content TEXT NOT NULL,\n        description TEXT,\n        category_id INTEGER,\n        template_id INTEGER,\n        tags TEXT, -- JSON array of tags\n        is_favorite BOOLEAN DEFAULT FALSE,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        FOREIGN KEY (category_id) REFERENCES categories (id),\n        FOREIGN KEY (template_id) REFERENCES templates (id)\n      )`,\n\n      // Prompt versions table for history tracking\n      `CREATE TABLE IF NOT EXISTS prompt_versions (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        prompt_id INTEGER NOT NULL,\n        content TEXT NOT NULL,\n        version_number INTEGER NOT NULL,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        FOREIGN KEY (prompt_id) REFERENCES prompts (id) ON DELETE CASCADE\n      )`,\n\n      // Test results table\n      `CREATE TABLE IF NOT EXISTS test_results (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        prompt_id INTEGER NOT NULL,\n        input_prompt TEXT NOT NULL,\n        response TEXT NOT NULL,\n        model TEXT,\n        api_endpoint TEXT,\n        response_time INTEGER,\n        token_usage TEXT, -- JSON object with usage stats\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        FOREIGN KEY (prompt_id) REFERENCES prompts (id) ON DELETE CASCADE\n      )`\n    ]\n\n    let completed = 0\n    const total = tables.length\n\n    if (total === 0) {\n      return resolve()\n    }\n\n    tables.forEach((sql, index) => {\n      database!.run(sql, (err) => {\n        if (err) {\n          console.error(`Error creating table ${index}:`, err)\n          return reject(err)\n        }\n\n        completed++\n\n        if (completed === total) {\n          insertDefaultData()\n            .then(resolve)\n            .catch(reject)\n        }\n      })\n    })\n  })\n}\n\nconst insertDefaultData = (): Promise<void> => {\n  return new Promise((resolve, reject) => {\n    if (!database) return reject(new Error('Database not initialized'))\n\n    // Check if this is first time setup by looking at settings\n    database.get('SELECT value FROM settings WHERE key = ?', ['first_time_setup_complete'], (err, row: any) => {\n      if (err) {\n        console.error('Error checking first time setup:', err)\n        return reject(err)\n      }\n\n      // If first time setup is already complete, just insert basic categories if none exist\n      if (row && row.value === 'true') {\n        database!.get('SELECT COUNT(*) as count FROM categories', (countErr, countRow: any) => {\n          if (countErr) {\n            console.error('Error checking existing categories:', countErr)\n            return reject(countErr)\n          }\n          \n          if (countRow.count > 0) {\n            return resolve() // Data already exists\n          }\n          \n          // Insert just basic categories for existing users\n          insertBasicCategories().then(resolve).catch(reject)\n        })\n        return\n      }\n\n      // This is first time setup - insert sample data\n      console.log('First time setup detected - inserting sample data...')\n      insertSampleData()\n        .then(() => {\n          // Mark first time setup as complete\n          database!.run('INSERT OR REPLACE INTO settings (key, value) VALUES (?, ?)', \n            ['first_time_setup_complete', 'true'], \n            (settingErr) => {\n              if (settingErr) {\n                console.error('Error marking first time setup complete:', settingErr)\n                return reject(settingErr)\n              }\n              console.log('Sample data loaded successfully - first time setup complete')\n              resolve()\n            }\n          )\n        })\n        .catch(reject)\n    })\n  })\n}\n\nconst insertBasicCategories = (): Promise<void> => {\n  return new Promise((resolve, reject) => {\n    if (!database) return reject(new Error('Database not initialized'))\n\n    // Insert just the basic default categories (no sample prompts)\n    const basicCategories = [\n      { name: 'General', description: 'General purpose prompts', color: '#007acc' },\n      { name: 'Creative Writing', description: 'Prompts for creative writing tasks', color: '#ff6b6b' },\n      { name: 'Code Generation', description: 'Programming and code-related prompts', color: '#4ecdc4' },\n      { name: 'Analysis', description: 'Data analysis and research prompts', color: '#45b7d1' },\n      { name: 'Business', description: 'Business and professional prompts', color: '#96ceb4' }\n    ]\n\n    database.run('BEGIN TRANSACTION', (beginErr) => {\n      if (beginErr) {\n        console.error('Error starting transaction:', beginErr)\n        return reject(beginErr)\n      }\n\n      let completed = 0\n      const total = basicCategories.length\n\n      basicCategories.forEach((category) => {\n        database!.run(\n          'INSERT OR IGNORE INTO categories (name, description, color) VALUES (?, ?, ?)',\n          [category.name, category.description, category.color],\n          function(err) {\n            if (err) {\n              console.error('Error inserting basic category:', err)\n              database!.run('ROLLBACK')\n              return reject(err)\n            }\n            \n            completed++\n            if (completed === total) {\n              database!.run('COMMIT', (commitErr) => {\n                if (commitErr) {\n                  console.error('Error committing basic categories:', commitErr)\n                  return reject(commitErr)\n                }\n                resolve()\n              })\n            }\n          }\n        )\n      })\n    })\n  })\n}\n\nconst insertSampleData = (): Promise<void> => {\n  return new Promise((resolve, reject) => {\n    if (!database) return reject(new Error('Database not initialized'))\n\n    // Use transaction for all sample data\n    database.run('BEGIN TRANSACTION', (beginErr) => {\n      if (beginErr) {\n        console.error('Error starting sample data transaction:', beginErr)\n        return reject(beginErr)\n      }\n\n      let totalOperations = 0\n      let completedOperations = 0\n\n      // Insert categories first\n      const categoriesToInsert = [...sampleCategories]\n      totalOperations += categoriesToInsert.length\n\n      const checkComplete = () => {\n        completedOperations++\n        if (completedOperations === totalOperations) {\n          database!.run('COMMIT', (commitErr) => {\n            if (commitErr) {\n              console.error('Error committing sample data:', commitErr)\n              database!.run('ROLLBACK')\n              return reject(commitErr)\n            }\n            resolve()\n          })\n        }\n      }\n\n      // Insert sample categories and get their IDs\n      let processedCategories = 0\n      const categoryIdMap = new Map<string, number>()\n\n      categoriesToInsert.forEach((category, index) => {\n        // First try to insert, then get the ID regardless of whether it was inserted or already existed\n        database!.run(\n          'INSERT OR IGNORE INTO categories (name, description, color) VALUES (?, ?, ?)',\n          [category.name, category.description, category.color],\n          function(insertErr) {\n            if (insertErr) {\n              console.error('Error inserting sample category:', insertErr)\n              database!.run('ROLLBACK')\n              return reject(insertErr)\n            }\n            \n            // Now get the actual ID for this category\n            database!.get(\n              'SELECT id FROM categories WHERE name = ?',\n              [category.name],\n              function(selectErr, row: any) {\n                if (selectErr) {\n                  console.error('Error getting category ID:', selectErr)\n                  database!.run('ROLLBACK')\n                  return reject(selectErr)\n                }\n                \n                const categoryId = row.id\n                categoryIdMap.set(category.name, categoryId)\n\n                // Insert templates for this category\n                const categoryTemplates = sampleTemplates.filter(t => t.category_id === (index + 1))\n                totalOperations += categoryTemplates.length\n\n                categoryTemplates.forEach((template) => {\n                  database!.run(\n                    'INSERT OR IGNORE INTO templates (name, description, content, variables, category_id) VALUES (?, ?, ?, ?, ?)',\n                    [template.name, template.description, template.content, JSON.stringify(template.variables), categoryId],\n                    (templateErr) => {\n                      if (templateErr) {\n                        console.error('Error inserting sample template:', templateErr)\n                        database!.run('ROLLBACK')\n                        return reject(templateErr)\n                      }\n                      checkComplete()\n                    }\n                  )\n                })\n\n                // Insert prompts for this category\n                const categoryPrompts = samplePrompts.filter(p => p.category_id === (index + 1))\n                totalOperations += categoryPrompts.length\n\n                categoryPrompts.forEach((prompt) => {\n                  database!.run(\n                    'INSERT OR IGNORE INTO prompts (title, content, description, category_id, template_id, tags, is_favorite) VALUES (?, ?, ?, ?, ?, ?, ?)',\n                    [\n                      prompt.title,\n                      prompt.content,\n                      prompt.description || null,\n                      categoryId,\n                      prompt.template_id || null,\n                      JSON.stringify(prompt.tags || []),\n                      prompt.is_favorite || false\n                    ],\n                    function(promptErr) {\n                      if (promptErr) {\n                        console.error('Error inserting sample prompt:', promptErr)\n                        database!.run('ROLLBACK')\n                        return reject(promptErr)\n                      }\n                      \n                      // Only create version if prompt was actually inserted (lastID > 0)\n                      if (this.lastID > 0) {\n                        database!.run(\n                          'INSERT INTO prompt_versions (prompt_id, content, version_number) VALUES (?, ?, ?)',\n                          [this.lastID, prompt.content, 1],\n                          (versionErr) => {\n                            if (versionErr) {\n                              console.error('Error inserting prompt version:', versionErr)\n                            }\n                            checkComplete()\n                          }\n                        )\n                      } else {\n                        checkComplete()\n                      }\n                    }\n                  )\n                })\n\n                checkComplete()\n              }\n            )\n          }\n        )\n      })\n    })\n  })\n}\n\n// Factory reset function - clears all user data and resets to sample data\nexport const factoryReset = (): Promise<void> => {\n  return new Promise((resolve, reject) => {\n    if (!database) return reject(new Error('Database not initialized'))\n\n    console.log('Performing factory reset...')\n    \n    database.run('BEGIN TRANSACTION', (beginErr) => {\n      if (beginErr) {\n        console.error('Error starting factory reset transaction:', beginErr)\n        return reject(beginErr)\n      }\n\n      // Delete all data in reverse order of dependencies\n      const deleteQueries = [\n        'DELETE FROM test_results',\n        'DELETE FROM prompt_versions', \n        'DELETE FROM prompts',\n        'DELETE FROM templates',\n        'DELETE FROM categories',\n        'DELETE FROM settings WHERE key != \"first_time_setup_complete\"' // Keep the first time setup flag\n      ]\n\n      let completed = 0\n      const total = deleteQueries.length\n\n      deleteQueries.forEach((query) => {\n        database!.run(query, (err) => {\n          if (err) {\n            console.error('Error during factory reset:', err)\n            database!.run('ROLLBACK')\n            return reject(err)\n          }\n          \n          completed++\n          if (completed === total) {\n            // Reset the first time setup flag so sample data will be loaded again\n            database!.run(\n              'UPDATE settings SET value = ? WHERE key = ?',\n              ['false', 'first_time_setup_complete'],\n              (updateErr) => {\n                if (updateErr) {\n                  console.error('Error resetting first time setup flag:', updateErr)\n                  database!.run('ROLLBACK')\n                  return reject(updateErr)\n                }\n                \n                database!.run('COMMIT', (commitErr) => {\n                  if (commitErr) {\n                    console.error('Error committing factory reset:', commitErr)\n                    return reject(commitErr)\n                  }\n                  console.log('Factory reset completed successfully')\n                  resolve()\n                })\n              }\n            )\n          }\n        })\n      })\n    })\n  })\n}\n\nexport const closeDatabase = (): Promise<void> => {\n  return new Promise((resolve) => {\n    if (database) {\n      database.close((err) => {\n        if (err) {\n          console.error('Error closing database:', err)\n        } else {\n          console.log('Database connection closed')\n        }\n        database = null\n        resolve()\n      })\n    } else {\n      resolve()\n    }\n  })\n}","import { createServer, IncomingMessage, ServerResponse } from 'http'\nimport { parse } from 'url'\nimport { Database } from 'sqlite3'\n\ninterface McpServerConfig {\n  port: number\n  host: string\n  enableAuth: boolean\n  apiKey: string\n  maxConnections: number\n  rateLimit: number\n  enableCors: boolean\n  enableLogging: boolean\n  logLevel: string\n}\n\ninterface ExposedPrompt {\n  id: number\n  secureHash: string\n  exposed: boolean\n}\n\nclass McpServer {\n  private server: any = null\n  private config: McpServerConfig\n  private db: Database\n  private exposedPrompts: Map<string, number> = new Map()\n  private requestCounts: Map<string, { count: number; resetTime: number }> = new Map()\n  \n  // Metrics tracking\n  private startTime: number = 0\n  private totalRequests: number = 0\n  private totalErrors: number = 0\n  private activeConnections: number = 0\n  private recentLogs: Array<{ timestamp: string; level: string; message: string; data?: any }> = []\n  private readonly MAX_LOGS = 50 // Keep more logs internally, show recent 10 in UI\n\n  constructor(db: Database) {\n    this.db = db\n    this.config = {\n      port: 3000,\n      host: '0.0.0.0',\n      enableAuth: true,\n      apiKey: '',\n      maxConnections: 100,\n      rateLimit: 60,\n      enableCors: true,\n      enableLogging: true,\n      logLevel: 'info'\n    }\n  }\n\n  updateConfig(config: Partial<McpServerConfig>) {\n    this.config = { ...this.config, ...config }\n  }\n\n  updateExposedPrompts(prompts: ExposedPrompt[]) {\n    this.exposedPrompts.clear()\n    let count = 0\n    prompts.forEach(p => {\n      if (p.exposed && p.secureHash) {\n        this.exposedPrompts.set(p.secureHash, p.id)\n        count++\n      }\n    })\n    this.log('info', `Updated exposed prompts: ${count} prompts now available`)\n  }\n\n  private log(level: string, message: string, ...args: any[]) {\n    const timestamp = new Date().toISOString()\n    \n    // Store log entry\n    const logEntry = {\n      timestamp,\n      level: level.toUpperCase(),\n      message,\n      data: args.length > 0 ? args : undefined\n    }\n    \n    this.recentLogs.push(logEntry)\n    \n    // Keep only recent logs\n    if (this.recentLogs.length > this.MAX_LOGS) {\n      this.recentLogs = this.recentLogs.slice(-this.MAX_LOGS)\n    }\n    \n    if (!this.config.enableLogging) return\n    \n    const levels = ['debug', 'info', 'warn', 'error']\n    const configLevel = levels.indexOf(this.config.logLevel)\n    const messageLevel = levels.indexOf(level)\n    \n    if (messageLevel >= configLevel) {\n      console.log(`[MCP Server ${timestamp}] [${level.toUpperCase()}] ${message}`, ...args)\n    }\n  }\n\n  private checkRateLimit(ip: string): boolean {\n    const now = Date.now()\n    const limit = this.requestCounts.get(ip)\n    \n    if (!limit || limit.resetTime < now) {\n      // Reset rate limit window\n      this.requestCounts.set(ip, {\n        count: 1,\n        resetTime: now + 60000 // 1 minute window\n      })\n      return true\n    }\n    \n    if (limit.count >= this.config.rateLimit) {\n      return false\n    }\n    \n    limit.count++\n    return true\n  }\n\n  private sendCorsHeaders(res: ServerResponse) {\n    if (this.config.enableCors) {\n      res.setHeader('Access-Control-Allow-Origin', '*')\n      res.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS')\n      res.setHeader('Access-Control-Allow-Headers', 'Content-Type, Authorization')\n    }\n  }\n\n  private sendJsonResponse(res: ServerResponse, statusCode: number, data: any) {\n    // Track errors (4xx and 5xx status codes)\n    if (statusCode >= 400) {\n      this.totalErrors++\n    }\n    \n    this.sendCorsHeaders(res)\n    res.writeHead(statusCode, { 'Content-Type': 'application/json' })\n    res.end(JSON.stringify(data))\n  }\n\n  private authenticateRequest(req: IncomingMessage): boolean {\n    if (!this.config.enableAuth) return true\n    \n    const authHeader = req.headers['authorization']\n    if (!authHeader) return false\n    \n    const [type, token] = authHeader.split(' ')\n    if (type !== 'Bearer' || token !== this.config.apiKey) {\n      return false\n    }\n    \n    return true\n  }\n\n  private getPromptById(promptId: number): Promise<any> {\n    return new Promise((resolve, reject) => {\n      try {\n        const query = `\n          SELECT p.*, c.name as category_name, c.color as category_color\n          FROM prompts p\n          LEFT JOIN categories c ON p.category_id = c.id\n          WHERE p.id = ?\n        `\n        this.db.get(query, [promptId], (err, row) => {\n          if (err) {\n            this.log('error', 'Database error getting prompt:', { promptId, error: err.message })\n            reject(err)\n          } else {\n            resolve(row)\n          }\n        })\n      } catch (error) {\n        this.log('error', 'Failed to get prompt from database:', error)\n        reject(error)\n      }\n    })\n  }\n\n  private getAllExposedPrompts(): Promise<any[]> {\n    return new Promise((resolve, reject) => {\n      try {\n        const promptIds = Array.from(this.exposedPrompts.values())\n        if (promptIds.length === 0) {\n          resolve([])\n          return\n        }\n        \n        const placeholders = promptIds.map(() => '?').join(',')\n        const query = `\n          SELECT p.*, c.name as category_name, c.color as category_color\n          FROM prompts p\n          LEFT JOIN categories c ON p.category_id = c.id\n          WHERE p.id IN (${placeholders})\n        `\n        \n        this.db.all(query, promptIds, (err, rows) => {\n          if (err) {\n            this.log('error', 'Failed to get exposed prompts from database:', err)\n            resolve([])\n          } else {\n            resolve(rows || [])\n          }\n        })\n      } catch (error) {\n        this.log('error', 'Failed to get prompts from database:', error)\n        resolve([])\n      }\n    })\n  }\n\n  private handleRequest(req: IncomingMessage, res: ServerResponse) {\n    const ip = req.socket.remoteAddress || 'unknown'\n    \n    // Track metrics\n    this.totalRequests++\n    \n    // Log request\n    this.log('info', `${req.method} ${req.url} from ${ip}`)\n    \n    // Track connection\n    this.activeConnections++\n    \n    // Clean up connection count when response finishes\n    res.on('finish', () => {\n      this.activeConnections--\n    })\n    \n    // Handle OPTIONS for CORS\n    if (req.method === 'OPTIONS') {\n      this.sendCorsHeaders(res)\n      res.writeHead(204)\n      res.end()\n      return\n    }\n    \n    // Check rate limit\n    if (!this.checkRateLimit(ip)) {\n      this.sendJsonResponse(res, 429, {\n        error: 'Rate limit exceeded',\n        message: `Maximum ${this.config.rateLimit} requests per minute`\n      })\n      return\n    }\n    \n    // Check authentication\n    if (!this.authenticateRequest(req)) {\n      this.sendJsonResponse(res, 401, {\n        error: 'Unauthorized',\n        message: 'Invalid or missing API key'\n      })\n      return\n    }\n    \n    // Parse URL\n    const parsedUrl = parse(req.url || '', true)\n    const pathname = parsedUrl.pathname || ''\n    \n    // Route: GET /prompts\n    if (pathname === '/prompts' && req.method === 'GET') {\n      this.getAllExposedPrompts()\n        .then(prompts => {\n          const response = []\n          \n          for (const p of prompts) {\n            const hashEntry = Array.from(this.exposedPrompts.entries()).find(([hash, id]) => id === p.id)\n            const hash = hashEntry?.[0]\n            \n            if (!hash) {\n              this.log('warn', `No hash found for exposed prompt ID: ${p.id}`)\n              continue\n            }\n            \n            response.push({\n              id: hash,\n              title: p.title,\n              description: p.description,\n              category: p.category_name,\n              tags: p.tags ? JSON.parse(p.tags) : [],\n              endpoint: `/prompts/${hash}`\n            })\n          }\n          \n          this.sendJsonResponse(res, 200, {\n            prompts: response,\n            count: response.length\n          })\n        })\n        .catch(error => {\n          this.log('error', 'Error getting exposed prompts list:', error)\n          this.sendJsonResponse(res, 500, {\n            error: 'Internal server error',\n            message: 'Failed to retrieve exposed prompts'\n          })\n        })\n      return\n    }\n    \n    // Route: GET /prompts/:hash\n    const promptMatch = pathname.match(/^\\/prompts\\/([a-zA-Z0-9]+)$/)\n    if (promptMatch && req.method === 'GET') {\n      const hash = promptMatch[1]\n      const promptId = this.exposedPrompts.get(hash)\n      \n      if (!promptId) {\n        this.sendJsonResponse(res, 404, {\n          error: 'Not found',\n          message: 'Prompt not found or not exposed'\n        })\n        return\n      }\n      \n      this.getPromptById(promptId)\n        .then(prompt => {\n          if (!prompt) {\n            this.sendJsonResponse(res, 404, {\n              error: 'Not found',\n              message: 'Prompt not found'\n            })\n            return\n          }\n          \n          const response = {\n            id: hash,\n            title: prompt.title || 'Untitled',\n            description: prompt.description || '',\n            content: prompt.content || '',\n            category: prompt.category_name || null,\n            tags: prompt.tags ? JSON.parse(prompt.tags) : [],\n            metadata: {\n              created_at: prompt.created_at,\n              updated_at: prompt.updated_at,\n              is_favorite: prompt.is_favorite\n            }\n          }\n          \n          this.sendJsonResponse(res, 200, response)\n        })\n        .catch(error => {\n          console.error('MCP Server: Error getting prompt:', error)\n          this.sendJsonResponse(res, 500, {\n            error: 'Internal server error',\n            message: 'Failed to retrieve prompt'\n          })\n        })\n      return\n    }\n    \n    // Route: POST /prompts/:hash/execute\n    const executeMatch = pathname.match(/^\\/prompts\\/([a-zA-Z0-9]+)\\/execute$/)\n    if (executeMatch && req.method === 'POST') {\n      const hash = executeMatch[1]\n      const promptId = this.exposedPrompts.get(hash)\n      \n      if (!promptId) {\n        this.sendJsonResponse(res, 404, {\n          error: 'Not found',\n          message: 'Prompt not found or not exposed'\n        })\n        return\n      }\n      \n      // Collect POST data\n      let body = ''\n      req.on('data', chunk => {\n        body += chunk.toString()\n      })\n      \n      req.on('end', () => {\n        this.getPromptById(promptId)\n          .then(prompt => {\n            if (!prompt) {\n              this.sendJsonResponse(res, 404, {\n                error: 'Not found',\n                message: 'Prompt not found'\n              })\n              return\n            }\n            \n            try {\n              const params = body ? JSON.parse(body) : {}\n              \n              // Process prompt with parameters\n              let processedContent = prompt.content\n              if (params.variables) {\n                Object.entries(params.variables).forEach(([key, value]) => {\n                  processedContent = processedContent.replace(\n                    new RegExp(`{{${key}}}`, 'g'),\n                    String(value)\n                  )\n                })\n              }\n              \n              this.sendJsonResponse(res, 200, {\n                prompt: processedContent,\n                metadata: {\n                  title: prompt.title,\n                  description: prompt.description,\n                  parameters_applied: params.variables || {}\n                }\n              })\n            } catch (error) {\n              this.sendJsonResponse(res, 400, {\n                error: 'Bad request',\n                message: 'Invalid JSON in request body'\n              })\n            }\n          })\n          .catch(error => {\n            console.error('MCP Server: Error getting prompt for execute:', error)\n            this.sendJsonResponse(res, 500, {\n              error: 'Internal server error',\n              message: 'Failed to retrieve prompt'\n            })\n          })\n      })\n      return\n    }\n    \n    // Route: GET /health\n    if (pathname === '/health' && req.method === 'GET') {\n      this.sendJsonResponse(res, 200, {\n        status: 'healthy',\n        server: 'Prompt Studio MCP Server',\n        uptime: process.uptime(),\n        exposedPrompts: this.exposedPrompts.size\n      })\n      return\n    }\n    \n    // 404 for unknown routes\n    this.sendJsonResponse(res, 404, {\n      error: 'Not found',\n      message: 'Endpoint not found'\n    })\n  }\n\n  start(): Promise<{ success: boolean; message: string; port?: number }> {\n    return new Promise((resolve) => {\n      if (this.server) {\n        resolve({\n          success: false,\n          message: 'Server is already running'\n        })\n        return\n      }\n      \n      try {\n        this.server = createServer((req, res) => this.handleRequest(req, res))\n        \n        this.server.on('error', (error: any) => {\n          this.log('error', 'Server error:', error)\n          if (error.code === 'EADDRINUSE') {\n            resolve({\n              success: false,\n              message: `Port ${this.config.port} is already in use`\n            })\n          } else {\n            resolve({\n              success: false,\n              message: `Failed to start server: ${error.message}`\n            })\n          }\n          this.server = null\n        })\n        \n        this.server.listen(this.config.port, this.config.host, () => {\n          this.startTime = Date.now()\n          this.totalRequests = 0\n          this.totalErrors = 0\n          this.activeConnections = 0\n          \n          this.log('info', `MCP Server started on http://${this.config.host}:${this.config.port}`)\n          resolve({\n            success: true,\n            message: 'Server started successfully',\n            port: this.config.port\n          })\n        })\n      } catch (error: any) {\n        this.log('error', 'Failed to create server:', error)\n        resolve({\n          success: false,\n          message: `Failed to create server: ${error.message}`\n        })\n      }\n    })\n  }\n\n  stop(): Promise<{ success: boolean; message: string }> {\n    return new Promise((resolve) => {\n      if (!this.server) {\n        resolve({\n          success: false,\n          message: 'Server is not running'\n        })\n        return\n      }\n      \n      try {\n        this.server.close(() => {\n          this.log('info', 'MCP Server stopped')\n          this.server = null\n          resolve({\n            success: true,\n            message: 'Server stopped successfully'\n          })\n        })\n      } catch (error: any) {\n        this.log('error', 'Failed to stop server:', error)\n        resolve({\n          success: false,\n          message: `Failed to stop server: ${error.message}`\n        })\n      }\n    })\n  }\n\n  isRunning(): boolean {\n    return this.server !== null\n  }\n\n  getStatus() {\n    const uptime = this.isRunning() ? Math.floor((Date.now() - this.startTime) / 1000) : 0\n    \n    return {\n      running: this.isRunning(),\n      port: this.isRunning() ? this.config.port : 0,\n      exposedPrompts: this.exposedPrompts.size,\n      connections: this.activeConnections,\n      uptime: uptime,\n      requests: this.totalRequests,\n      errors: this.totalErrors,\n      logs: this.recentLogs.slice(-10).reverse(), // Get recent 10 logs, newest first\n      config: this.config\n    }\n  }\n\n  clearLogs() {\n    this.recentLogs = []\n    this.log('info', 'Server logs cleared')\n  }\n}\n\nexport default McpServer","import { Database } from 'sqlite3'\nimport { writeFileSync, readFileSync } from 'fs'\nimport { extname, basename } from 'path'\nimport type {\n  Prompt,\n  Category,\n  Template,\n  PromptVersion,\n  CreatePromptData,\n  UpdatePromptData,\n  CreateCategoryData,\n  UpdateCategoryData,\n  CreateTemplateData,\n  UpdateTemplateData,\n  ImportResult,\n} from '../../src/types'\n\n// Utility function to promisify database operations with transaction support\nconst runQuery = (db: Database, sql: string, params: any[] = []): Promise<{ id: number; changes: number }> => {\n  return new Promise((resolve, reject) => {\n    db.serialize(() => {\n      db.run(sql, params, function(err) {\n        if (err) {\n          reject(err)\n        } else {\n          resolve({ id: this.lastID, changes: this.changes })\n        }\n      })\n    })\n  })\n}\n\nconst getQuery = <T = any>(db: Database, sql: string, params: any[] = []): Promise<T | undefined> => {\n  return new Promise((resolve, reject) => {\n    db.get(sql, params, (err, row) => {\n      if (err) {\n        reject(err)\n      } else {\n        resolve(row)\n      }\n    })\n  })\n}\n\nconst allQuery = <T = any>(db: Database, sql: string, params: any[] = []): Promise<T[]> => {\n  return new Promise((resolve, reject) => {\n    db.all(sql, params, (err, rows) => {\n      if (err) {\n        reject(err)\n      } else {\n        resolve(rows)\n      }\n    })\n  })\n}\n\n// PROMPTS OPERATIONS\nexport const getAllPrompts = async (db: Database): Promise<readonly Prompt[]> => {\n  const sql = `\n    SELECT p.*, c.name as category_name, c.color as category_color,\n           t.name as template_name\n    FROM prompts p\n    LEFT JOIN categories c ON p.category_id = c.id\n    LEFT JOIN templates t ON p.template_id = t.id\n    ORDER BY p.updated_at DESC\n  `\n  const rows = await allQuery<any>(db, sql)\n  const prompts = rows.map(row => ({\n    ...row,\n    tags: row.tags ? JSON.parse(row.tags) : [],\n    is_favorite: Boolean(row.is_favorite)\n  })) as readonly Prompt[]\n  return prompts\n}\n\nexport const getPrompt = async (db: Database, id: number): Promise<Prompt | null> => {\n  const sql = `\n    SELECT p.*, c.name as category_name, c.color as category_color,\n           t.name as template_name\n    FROM prompts p\n    LEFT JOIN categories c ON p.category_id = c.id\n    LEFT JOIN templates t ON p.template_id = t.id\n    WHERE p.id = ?\n  `\n  const row = await getQuery<any>(db, sql, [id])\n  if (row) {\n    return {\n      ...row,\n      tags: row.tags ? JSON.parse(row.tags) : [],\n      is_favorite: Boolean(row.is_favorite)\n    } as Prompt\n  }\n  return null\n}\n\nexport const createPrompt = async (db: Database, prompt: CreatePromptData): Promise<Prompt> => {\n  const { title, content, description, category_id, template_id, tags, is_favorite } = prompt\n  const sql = `\n    INSERT INTO prompts (title, content, description, category_id, template_id, tags, is_favorite)\n    VALUES (?, ?, ?, ?, ?, ?, ?)\n  `\n  const result = await runQuery(db, sql, [\n    title,\n    content,\n    description || null,\n    category_id || null,\n    template_id || null,\n    JSON.stringify(tags || []),\n    is_favorite || false\n  ])\n\n  // Create initial version\n  await createPromptVersion(db, result.id, content)\n\n  const created = await getPrompt(db, result.id)\n  if (!created) throw new Error('Failed to create prompt')\n  return created\n}\n\nexport const updatePrompt = async (db: Database, id: number, prompt: UpdatePromptData): Promise<Prompt> => {\n  const { title, content, description, category_id, template_id, tags, is_favorite } = prompt\n\n  // Get current prompt to preserve existing values and check if content changed\n  const currentPrompt = await getPrompt(db, id)\n  if (!currentPrompt) throw new Error('Prompt not found')\n\n  // Build dynamic SQL query with only provided fields\n  const updates: string[] = []\n  const values: any[] = []\n\n  if (title !== undefined) {\n    updates.push('title = ?')\n    values.push(title)\n  }\n\n  if (content !== undefined) {\n    updates.push('content = ?')\n    values.push(content)\n  }\n\n  if (description !== undefined) {\n    updates.push('description = ?')\n    values.push(description || null)\n  }\n\n  if (category_id !== undefined) {\n    updates.push('category_id = ?')\n    values.push(category_id || null)\n  }\n\n  if (template_id !== undefined) {\n    updates.push('template_id = ?')\n    values.push(template_id || null)\n  }\n\n  if (tags !== undefined) {\n    updates.push('tags = ?')\n    values.push(JSON.stringify(tags || []))\n  }\n\n  if (is_favorite !== undefined) {\n    updates.push('is_favorite = ?')\n    values.push(is_favorite)\n  }\n\n  if (updates.length === 0) {\n    // No updates to make, return current prompt\n    return currentPrompt\n  }\n\n  // Always update the timestamp\n  updates.push('updated_at = CURRENT_TIMESTAMP')\n  values.push(id) // Add id for WHERE clause\n\n  const sql = `UPDATE prompts SET ${updates.join(', ')} WHERE id = ?`\n  await runQuery(db, sql, values)\n\n  // Create new version if content changed\n  if (content !== undefined && currentPrompt.content !== content) {\n    const versions = await getPromptVersions(db, id)\n    await createPromptVersion(db, id, content, versions.length + 1)\n  }\n\n  const updated = await getPrompt(db, id)\n  if (!updated) throw new Error('Failed to update prompt')\n  return updated\n}\n\nexport const deletePrompt = async (db: Database, id: number): Promise<{ success: boolean }> => {\n  const sql = 'DELETE FROM prompts WHERE id = ?'\n  await runQuery(db, sql, [id])\n  return { success: true }\n}\n\nexport const searchPrompts = async (db: Database, query: string): Promise<readonly Prompt[]> => {\n  const sql = `\n    SELECT p.*, c.name as category_name, c.color as category_color,\n           t.name as template_name\n    FROM prompts p\n    LEFT JOIN categories c ON p.category_id = c.id\n    LEFT JOIN templates t ON p.template_id = t.id\n    WHERE p.title LIKE ? OR p.content LIKE ? OR p.description LIKE ?\n    ORDER BY p.updated_at DESC\n  `\n  const searchTerm = `%${query}%`\n  const rows = await allQuery<any>(db, sql, [searchTerm, searchTerm, searchTerm])\n  return rows.map(row => ({\n    ...row,\n    tags: row.tags ? JSON.parse(row.tags) : [],\n    is_favorite: Boolean(row.is_favorite)\n  })) as readonly Prompt[]\n}\n\nexport const getPromptsByTag = async (db: Database, tag: string): Promise<readonly Prompt[]> => {\n  const sql = `\n    SELECT p.*, c.name as category_name, c.color as category_color,\n           t.name as template_name\n    FROM prompts p\n    LEFT JOIN categories c ON p.category_id = c.id\n    LEFT JOIN templates t ON p.template_id = t.id\n    WHERE p.tags LIKE ?\n    ORDER BY p.updated_at DESC\n  `\n  const rows = await allQuery<any>(db, sql, [`%\"${tag}\"%`])\n  return rows.map(row => ({\n    ...row,\n    tags: row.tags ? JSON.parse(row.tags) : [],\n    is_favorite: Boolean(row.is_favorite)\n  })) as readonly Prompt[]\n}\n\nexport const getAllTags = async (db: Database): Promise<readonly string[]> => {\n  const sql = 'SELECT DISTINCT tags FROM prompts WHERE tags IS NOT NULL AND tags != \"[]\"'\n  const rows = await allQuery<{ tags: string }>(db, sql)\n  const allTags = new Set<string>()\n\n  rows.forEach(row => {\n    try {\n      const tags = JSON.parse(row.tags) as string[]\n      tags.forEach(tag => allTags.add(tag))\n    } catch (e) {\n      // Skip invalid JSON\n    }\n  })\n\n  return Array.from(allTags).sort()\n}\n\n// PROMPT VERSIONS\nexport const getPromptVersions = async (db: Database, promptId: number): Promise<readonly PromptVersion[]> => {\n  const sql = `\n    SELECT * FROM prompt_versions \n    WHERE prompt_id = ? \n    ORDER BY version_number DESC\n  `\n  return await allQuery<PromptVersion>(db, sql, [promptId]) as readonly PromptVersion[]\n}\n\nexport const createPromptVersion = async (db: Database, promptId: number, content: string, versionNumber?: number): Promise<PromptVersion> => {\n  if (!versionNumber) {\n    const versions = await getPromptVersions(db, promptId)\n    versionNumber = versions.length + 1\n  }\n\n  const sql = `\n    INSERT INTO prompt_versions (prompt_id, content, version_number)\n    VALUES (?, ?, ?)\n  `\n  const result = await runQuery(db, sql, [promptId, content, versionNumber])\n  \n  return {\n    id: result.id,\n    prompt_id: promptId,\n    content,\n    version_number: versionNumber,\n    created_at: new Date().toISOString()\n  }\n}\n\n// CATEGORIES\nexport const getAllCategories = async (db: Database): Promise<readonly Category[]> => {\n  const sql = 'SELECT * FROM categories ORDER BY name'\n  return await allQuery<Category>(db, sql) as readonly Category[]\n}\n\nexport const createCategory = async (db: Database, category: CreateCategoryData): Promise<Category> => {\n  const { name, description, color } = category\n  const sql = 'INSERT INTO categories (name, description, color) VALUES (?, ?, ?)'\n  const result = await runQuery(db, sql, [name, description || null, color || '#007acc'])\n  \n  const created = await getQuery<Category>(db, 'SELECT * FROM categories WHERE id = ?', [result.id])\n  if (!created) throw new Error('Failed to create category')\n  return created\n}\n\nexport const updateCategory = async (db: Database, id: number, category: UpdateCategoryData): Promise<Category> => {\n  const { name, description, color } = category\n  const sql = `\n    UPDATE categories \n    SET name = ?, description = ?, color = ?, updated_at = CURRENT_TIMESTAMP\n    WHERE id = ?\n  `\n  await runQuery(db, sql, [name, description || null, color || '#007acc', id])\n  \n  const updated = await getQuery<Category>(db, 'SELECT * FROM categories WHERE id = ?', [id])\n  if (!updated) throw new Error('Failed to update category')\n  return updated\n}\n\nexport const deleteCategory = async (db: Database, id: number): Promise<{ success: boolean }> => {\n  // First, update prompts to remove the category reference\n  await runQuery(db, 'UPDATE prompts SET category_id = NULL WHERE category_id = ?', [id])\n  // Then delete the category\n  await runQuery(db, 'DELETE FROM categories WHERE id = ?', [id])\n  return { success: true }\n}\n\n// TEMPLATES\nexport const getAllTemplates = async (db: Database): Promise<readonly Template[]> => {\n  const sql = `\n    SELECT t.*, c.name as category_name, c.color as category_color\n    FROM templates t\n    LEFT JOIN categories c ON t.category_id = c.id\n    ORDER BY t.name\n  `\n  const rows = await allQuery<any>(db, sql)\n  return rows.map(row => ({\n    ...row,\n    variables: row.variables ? JSON.parse(row.variables) : []\n  })) as readonly Template[]\n}\n\nexport const createTemplate = async (db: Database, template: CreateTemplateData): Promise<Template> => {\n  const { name, description, content, variables, category_id } = template\n  const sql = `\n    INSERT INTO templates (name, description, content, variables, category_id)\n    VALUES (?, ?, ?, ?, ?)\n  `\n  const result = await runQuery(db, sql, [\n    name,\n    description || null,\n    content,\n    JSON.stringify(variables || []),\n    category_id || null\n  ])\n  \n  const created = await getQuery<any>(db, `\n    SELECT t.*, c.name as category_name, c.color as category_color\n    FROM templates t\n    LEFT JOIN categories c ON t.category_id = c.id\n    WHERE t.id = ?\n  `, [result.id])\n  \n  if (!created) throw new Error('Failed to create template')\n  \n  return {\n    ...created,\n    variables: created.variables ? JSON.parse(created.variables) : []\n  } as Template\n}\n\nexport const updateTemplate = async (db: Database, id: number, template: UpdateTemplateData): Promise<Template> => {\n  const { name, description, content, variables, category_id } = template\n  const sql = `\n    UPDATE templates \n    SET name = ?, description = ?, content = ?, variables = ?, category_id = ?, \n        updated_at = CURRENT_TIMESTAMP\n    WHERE id = ?\n  `\n  await runQuery(db, sql, [\n    name,\n    description || null,\n    content,\n    JSON.stringify(variables || []),\n    category_id || null,\n    id\n  ])\n  \n  const updated = await getQuery<any>(db, `\n    SELECT t.*, c.name as category_name, c.color as category_color\n    FROM templates t\n    LEFT JOIN categories c ON t.category_id = c.id\n    WHERE t.id = ?\n  `, [id])\n  \n  if (!updated) throw new Error('Failed to update template')\n  \n  return {\n    ...updated,\n    variables: updated.variables ? JSON.parse(updated.variables) : []\n  } as Template\n}\n\nexport const deleteTemplate = async (db: Database, id: number): Promise<{ success: boolean }> => {\n  // First, update prompts to remove the template reference\n  await runQuery(db, 'UPDATE prompts SET template_id = NULL WHERE template_id = ?', [id])\n  // Then delete the template\n  await runQuery(db, 'DELETE FROM templates WHERE id = ?', [id])\n  return { success: true }\n}\n\nexport const generateFromTemplate = async (db: Database, templateId: number, variables: Record<string, string>): Promise<CreatePromptData> => {\n  const template = await getQuery<Template>(db, 'SELECT * FROM templates WHERE id = ?', [templateId])\n  if (!template) {\n    throw new Error('Template not found')\n  }\n\n  let content = template.content\n\n  // Replace variables in the template\n  Object.entries(variables).forEach(([key, value]) => {\n    const regex = new RegExp(`{{${key}}}`, 'g')\n    content = content.replace(regex, value)\n  })\n\n  return {\n    title: `Generated from ${template.name}`,\n    content,\n    template_id: templateId,\n    category_id: template.category_id\n  }\n}\n\n// SETTINGS\nexport const getSetting = async (db: Database, key: string): Promise<string | null> => {\n  const row = await getQuery<{ value: string }>(db, 'SELECT value FROM settings WHERE key = ?', [key])\n  return row ? row.value : null\n}\n\nexport const setSetting = async (db: Database, key: string, value: string): Promise<{ key: string; value: string }> => {\n  const sql = `\n    INSERT OR REPLACE INTO settings (key, value, updated_at)\n    VALUES (?, ?, CURRENT_TIMESTAMP)\n  `\n  await runQuery(db, sql, [key, value])\n  return { key, value }\n}\n\n// EXPORT/IMPORT\nexport const exportPrompts = async (db: Database, filePath: string, format: 'json' | 'txt' = 'json'): Promise<void> => {\n  const prompts = await getAllPrompts(db)\n\n  if (format === 'json') {\n    const data = {\n      prompts,\n      exported_at: new Date().toISOString(),\n      version: '1.0.0'\n    }\n    writeFileSync(filePath, JSON.stringify(data, null, 2))\n  } else {\n    let content = 'Prompt Studio Export\\n'\n    content += '==================\\n\\n'\n\n    prompts.forEach((prompt, index) => {\n      content += `${index + 1}. ${prompt.title}\\n`\n      content += `Category: ${prompt.category_name || 'None'}\\n`\n      content += `Tags: ${prompt.tags.join(', ')}\\n`\n      content += `Created: ${prompt.created_at}\\n\\n`\n      content += `${prompt.content}\\n\\n`\n      if (prompt.description) {\n        content += `Description: ${prompt.description}\\n`\n      }\n      content += '---\\n\\n'\n    })\n\n    writeFileSync(filePath, content)\n  }\n}\n\nexport const importPrompts = async (db: Database, filePath: string): Promise<ImportResult> => {\n  try {\n    const content = readFileSync(filePath, 'utf8')\n    const ext = extname(filePath).toLowerCase()\n\n    if (ext === '.json') {\n      const data = JSON.parse(content)\n      const prompts = data.prompts || data // Handle both formats\n\n      let imported = 0\n      for (const prompt of prompts) {\n        try {\n          // Remove ID to avoid conflicts\n          const { id, created_at, updated_at, ...promptData } = prompt\n          await createPrompt(db, promptData)\n          imported++\n        } catch (err) {\n          console.error('Error importing prompt:', err)\n        }\n      }\n\n      return { success: true, imported, total: prompts.length }\n    } else {\n      // Simple text import - create one prompt from the file\n      const title = basename(filePath, ext)\n      await createPrompt(db, {\n        title,\n        content,\n        description: `Imported from ${filePath}`,\n        tags: ['imported']\n      })\n\n      return { success: true, imported: 1, total: 1 }\n    }\n  } catch (error) {\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Unknown error' \n    }\n  }\n}","import { app, BrowserWindow, ipcMain, Tray, Menu, nativeImage, dialog } from 'electron'\nimport { join } from 'path'\nimport { readFileSync, existsSync } from 'fs'\nimport { initDatabase, factoryReset } from './database/init'\nimport McpServer from './mcp-server'\nimport {\n  getAllPrompts,\n  getPrompt,\n  createPrompt,\n  updatePrompt,\n  deletePrompt,\n  searchPrompts,\n  getPromptsByTag,\n  getAllTags,\n  getPromptVersions,\n  createPromptVersion,\n  getSetting,\n  setSetting,\n  exportPrompts,\n  importPrompts,\n  getAllCategories,\n  createCategory,\n  updateCategory,\n  deleteCategory,\n  getAllTemplates,\n  createTemplate,\n  updateTemplate,\n  deleteTemplate,\n  generateFromTemplate,\n} from './database/queries'\nimport type { Database } from 'sqlite3'\nimport type {\n  CreatePromptData,\n  UpdatePromptData,\n  CreateCategoryData,\n  UpdateCategoryData,\n  CreateTemplateData,\n  UpdateTemplateData,\n  ApiTestRequest,\n  ApiTestResponse,\n  ImportResult,\n} from '../src/types'\n\nclass PromptStudioApp {\n  private mainWindow: BrowserWindow | null = null\n  private menuBarWindow: BrowserWindow | null = null\n  private tray: Tray | null = null\n  private db: Database | null = null\n  private mcpServer: McpServer | null = null\n  private currentMode: 'desktop' | 'menubar' = 'desktop'\n  private readonly isDev: boolean = process.env.IS_DEV === 'true'\n  private readonly enableDevTools: boolean = process.env.ENABLE_DEV_TOOLS === 'true'\n  private isQuitting: boolean = false\n\n  constructor() {\n    this.setupEventHandlers()\n  }\n\n  private setupEventHandlers(): void {\n    app.whenReady().then(() => {\n      this.initialize()\n    })\n\n    app.on('window-all-closed', () => {\n      if (process.platform !== 'darwin') {\n        app.quit()\n      }\n    })\n\n    app.on('activate', () => {\n      if (BrowserWindow.getAllWindows().length === 0) {\n        this.createMainWindow()\n      } else if (this.currentMode === 'desktop' && this.mainWindow) {\n        this.mainWindow.show()\n      }\n    })\n\n    app.on('before-quit', async () => {\n      this.isQuitting = true\n      // Close database connection\n      if (this.db) {\n        try {\n          const { closeDatabase } = await import('./database/init')\n          await closeDatabase()\n          console.log('Database closed on app quit')\n        } catch (error) {\n          console.error('Error closing database:', error)\n        }\n      }\n    })\n  }\n\n  private async initialize(): Promise<void> {\n    try {\n      // Initialize database\n      this.db = await initDatabase()\n      \n      // Initialize MCP server with database\n      this.mcpServer = new McpServer(this.db as any)\n      console.log('MCP Server initialized successfully')\n\n      // Load saved mode\n      const savedMode = await getSetting(this.db, 'appMode')\n      this.currentMode = (savedMode as 'desktop' | 'menubar') || 'desktop'\n\n      // Setup IPC handlers BEFORE creating windows\n      this.setupIpcHandlers()\n\n      // Create windows\n      await this.createMainWindow()\n      await this.createMenuBarWindow()\n      this.createTray()\n\n      // Show appropriate window\n      if (this.currentMode === 'desktop' && this.mainWindow) {\n        this.mainWindow.show()\n        this.mainWindow.focus()\n      }\n    } catch (error) {\n      console.error('Failed to initialize app:', error)\n      app.quit()\n    }\n  }\n\n  private async createMainWindow(): Promise<void> {\n    this.mainWindow = new BrowserWindow({\n      width: 1200,\n      height: 800,\n      show: false,\n      webPreferences: {\n        nodeIntegration: false,\n        contextIsolation: true,\n        preload: join(__dirname, 'preload.js'),\n      },\n      icon: this.getAppIcon(),\n      titleBarStyle: process.platform === 'darwin' ? 'hiddenInset' : 'default',\n    })\n\n    if (this.isDev) {\n      await this.mainWindow.loadURL('http://localhost:5173')\n      \n      // Only open dev tools if explicitly enabled\n      if (this.enableDevTools) {\n        this.mainWindow.webContents.openDevTools()\n      }\n    } else {\n      await this.mainWindow.loadFile(join(__dirname, '../dist/index.html'))\n    }\n\n    this.mainWindow.once('ready-to-show', () => {\n      if (this.currentMode === 'desktop' && this.mainWindow) {\n        this.mainWindow.show()\n        this.mainWindow.focus()\n      }\n    })\n\n    this.mainWindow.on('close', (event) => {\n      if (!this.isQuitting) {\n        event.preventDefault()\n        if (this.mainWindow) {\n          this.mainWindow.hide()\n        }\n      }\n    })\n\n    // Add keyboard shortcut to toggle dev tools\n    if (this.isDev) {\n      this.mainWindow.webContents.on('before-input-event', (_, input) => {\n        if (input.control && input.shift && input.key === 'I') {\n          this.mainWindow!.webContents.toggleDevTools()\n        }\n        if ((input.meta || input.control) && input.key === 'F12') {\n          this.mainWindow!.webContents.toggleDevTools()\n        }\n      })\n    }\n  }\n\n  private async createMenuBarWindow(): Promise<void> {\n    this.menuBarWindow = new BrowserWindow({\n      width: 400,\n      height: 600,\n      show: false,\n      frame: false,\n      resizable: false,\n      webPreferences: {\n        nodeIntegration: false,\n        contextIsolation: true,\n        preload: join(__dirname, 'preload.js'),\n      },\n      skipTaskbar: true,\n      alwaysOnTop: true,\n    })\n\n    if (this.isDev) {\n      await this.menuBarWindow.loadURL('http://localhost:5173/menubar')\n    } else {\n      await this.menuBarWindow.loadFile(join(__dirname, '../dist/menubar.html'))\n    }\n\n    this.menuBarWindow.on('blur', () => {\n      if (this.currentMode === 'menubar' && this.menuBarWindow) {\n        this.menuBarWindow.hide()\n      }\n    })\n  }\n\n  private createTray(): void {\n    const icon = this.createTrayIcon()\n    this.tray = new Tray(icon)\n\n    const contextMenu = Menu.buildFromTemplate([\n      {\n        label: 'Show Prompt Studio',\n        click: async () => await this.showApp(),\n      },\n      { type: 'separator' },\n      {\n        label: 'Desktop Mode',\n        type: 'radio',\n        checked: this.currentMode === 'desktop',\n        click: () => this.switchMode('desktop'),\n      },\n      {\n        label: 'Menu Bar Mode',\n        type: 'radio',\n        checked: this.currentMode === 'menubar',\n        click: () => this.switchMode('menubar'),\n      },\n      { type: 'separator' },\n      {\n        label: 'Quit',\n        click: () => {\n          this.isQuitting = true\n          app.quit()\n        },\n      },\n    ])\n\n    this.tray.setToolTip('Prompt Studio')\n    this.tray.setContextMenu(contextMenu)\n\n    this.tray.on('click', async () => {\n      if (process.platform !== 'darwin') {\n        await this.toggleApp()\n      }\n    })\n\n    if (process.platform === 'darwin') {\n      this.tray.on('right-click', async () => {\n        if (this.currentMode === 'menubar') {\n          await this.toggleMenuBarWindow()\n        }\n      })\n    }\n  }\n\n  private createTrayIcon(): Electron.NativeImage {\n    const trayIconPath = join(__dirname, '../assets/tray-icon.png')\n    if (existsSync(trayIconPath)) {\n      const icon = nativeImage.createFromPath(trayIconPath)\n      icon.setTemplateImage(true)\n      return icon.resize({ width: 16, height: 16 })\n    }\n\n    // Fallback to regular icon\n    const iconPath = join(__dirname, '../assets/icon.png')\n    if (existsSync(iconPath)) {\n      const icon = nativeImage.createFromPath(iconPath)\n      icon.setTemplateImage(true)\n      return icon.resize({ width: 16, height: 16 })\n    }\n\n    // Create a simple fallback icon\n    const icon = nativeImage.createFromDataURL(\n      'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAbwAAAG8B8aLcQwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAI4SURBVDjLpZPLSyNBEMafJBpfGI0vfIKKD1YR30HFhQVZWFjwgSiIBy+CBx8H8eJBL4IX8eJBD4IXD3oRvHjQi+DFgx4ELx70InjxoAfBiwc9CF48eJEkZjKZt91O05lJJsaD/UF3VVd9X1V3dwvAuHEEeEnNK24HAEhpWjTqsEgUEUlHYgAAAAAAAAD4/nONAAAOFyLSdF3l0AvI7Gii0XDbfU7k9+g7mRn1AHhhNBCJRm+yYdoECUCcvAHxvuwT2g5bMJHsJR0UiSLSSRFJwC'\n    )\n    icon.setTemplateImage(true)\n    return icon\n  }\n\n  private getAppIcon(): string {\n    const iconPath = join(__dirname, '../assets/icon.png')\n    return existsSync(iconPath) ? iconPath : ''\n  }\n\n  private async showApp(): Promise<void> {\n    if (this.currentMode === 'desktop' && this.mainWindow) {\n      this.mainWindow.show()\n      this.mainWindow.focus()\n    } else if (this.currentMode === 'menubar') {\n      await this.toggleMenuBarWindow()\n    }\n  }\n\n  private async toggleApp(): Promise<void> {\n    if (this.currentMode === 'desktop' && this.mainWindow) {\n      if (this.mainWindow.isVisible()) {\n        this.mainWindow.hide()\n      } else {\n        this.mainWindow.show()\n        this.mainWindow.focus()\n      }\n    } else {\n      await this.toggleMenuBarWindow()\n    }\n  }\n\n  private async toggleMenuBarWindow(): Promise<void> {\n    if (!this.menuBarWindow || !this.tray) return\n\n    if (this.menuBarWindow.isVisible()) {\n      this.menuBarWindow.hide()\n    } else {\n      // Ensure menubar window has the correct content\n      if (this.isDev) {\n        await this.menuBarWindow.loadURL('http://localhost:5173/menubar')\n      } else {\n        await this.menuBarWindow.loadFile(join(__dirname, '../dist/menubar.html'))\n      }\n      \n      const bounds = this.tray.getBounds()\n      const x = Math.round(bounds.x + bounds.width / 2 - 200)\n      const y = Math.round(bounds.y + bounds.height)\n\n      this.menuBarWindow.setPosition(x, y, false)\n      this.menuBarWindow.show()\n      this.menuBarWindow.focus()\n    }\n  }\n\n  private async switchMode(mode: 'desktop' | 'menubar'): Promise<void> {\n    this.currentMode = mode\n\n    if (this.db) {\n      await setSetting(this.db, 'appMode', mode)\n    }\n\n    if (mode === 'desktop') {\n      if (this.menuBarWindow) this.menuBarWindow.hide()\n      if (this.mainWindow) {\n        // Ensure the main window loads the correct URL for desktop mode\n        if (this.isDev) {\n          await this.mainWindow.loadURL('http://localhost:5173')\n        } else {\n          await this.mainWindow.loadFile(join(__dirname, '../dist/index.html'))\n        }\n        this.mainWindow.show()\n        this.mainWindow.focus()\n      }\n    } else {\n      if (this.mainWindow) this.mainWindow.hide()\n      if (this.menuBarWindow) this.menuBarWindow.hide()\n    }\n\n    this.updateTrayMenu()\n  }\n\n  private updateTrayMenu(): void {\n    if (!this.tray) return\n\n    const contextMenu = Menu.buildFromTemplate([\n      {\n        label: 'Show Prompt Studio',\n        click: async () => await this.showApp(),\n      },\n      { type: 'separator' },\n      {\n        label: 'Desktop Mode',\n        type: 'radio',\n        checked: this.currentMode === 'desktop',\n        click: () => this.switchMode('desktop'),\n      },\n      {\n        label: 'Menu Bar Mode',\n        type: 'radio',\n        checked: this.currentMode === 'menubar',\n        click: () => this.switchMode('menubar'),\n      },\n      { type: 'separator' },\n      {\n        label: 'Quit',\n        click: () => {\n          this.isQuitting = true\n          app.quit()\n        },\n      },\n    ])\n\n    this.tray.setContextMenu(contextMenu)\n  }\n\n\n  private setupIpcHandlers(): void {\n    // System handlers (don't require database)\n    ipcMain.handle('copy-to-clipboard', async (_event, text: string) => {\n      const { clipboard } = require('electron')\n      clipboard.writeText(text)\n      return { success: true }\n    })\n\n    ipcMain.handle('switch-mode', async (_event, mode: 'desktop' | 'menubar') => {\n      await this.switchMode(mode)\n    })\n\n    ipcMain.handle('get-current-mode', () => {\n      return this.currentMode\n    })\n\n    // Factory reset handler\n    ipcMain.handle('factory-reset', async () => {\n      try {\n        await factoryReset()\n        // Reinitialize database to load sample data\n        this.db = await initDatabase()\n        return { success: true }\n      } catch (error) {\n        console.error('Factory reset failed:', error)\n        return { success: false, error: error instanceof Error ? error.message : 'Unknown error' }\n      }\n    })\n\n    // Database-dependent handlers\n    if (!this.db) return\n\n    // Prompt handlers\n    ipcMain.handle('get-all-prompts', async () => {\n      return await getAllPrompts(this.db!)\n    })\n\n    ipcMain.handle('get-prompt', async (_event, id: number) => {\n      return await getPrompt(this.db!, id)\n    })\n\n    ipcMain.handle('create-prompt', async (_event, data: CreatePromptData) => {\n      return await createPrompt(this.db!, data)\n    })\n\n    ipcMain.handle('update-prompt', async (_event, id: number, data: UpdatePromptData) => {\n      return await updatePrompt(this.db!, id, data)\n    })\n\n    ipcMain.handle('delete-prompt', async (_event, id: number) => {\n      return await deletePrompt(this.db!, id)\n    })\n\n    ipcMain.handle('search-prompts', async (_event, query: string) => {\n      return await searchPrompts(this.db!, query)\n    })\n\n    ipcMain.handle('get-prompts-by-tag', async (_event, tag: string) => {\n      return await getPromptsByTag(this.db!, tag)\n    })\n\n    // Category handlers\n    ipcMain.handle('get-all-categories', async () => {\n      return await getAllCategories(this.db!)\n    })\n\n    ipcMain.handle('create-category', async (_event, data: CreateCategoryData) => {\n      return await createCategory(this.db!, data)\n    })\n\n    ipcMain.handle('update-category', async (_event, id: number, data: UpdateCategoryData) => {\n      return await updateCategory(this.db!, id, data)\n    })\n\n    ipcMain.handle('delete-category', async (_event, id: number) => {\n      return await deleteCategory(this.db!, id)\n    })\n\n    // Template handlers\n    ipcMain.handle('get-all-templates', async () => {\n      return await getAllTemplates(this.db!)\n    })\n\n    ipcMain.handle('create-template', async (_event, data: CreateTemplateData) => {\n      return await createTemplate(this.db!, data)\n    })\n\n    ipcMain.handle('update-template', async (_event, id: number, data: UpdateTemplateData) => {\n      return await updateTemplate(this.db!, id, data)\n    })\n\n    ipcMain.handle('delete-template', async (_event, id: number) => {\n      return await deleteTemplate(this.db!, id)\n    })\n\n    ipcMain.handle('generate-from-template', async (_event, templateId: number, variables: Record<string, string>) => {\n      return await generateFromTemplate(this.db!, templateId, variables)\n    })\n\n    // Tag handlers\n    ipcMain.handle('get-all-tags', async () => {\n      return await getAllTags(this.db!)\n    })\n\n    // Version handlers\n    ipcMain.handle('get-prompt-versions', async (_event, promptId: number) => {\n      return await getPromptVersions(this.db!, promptId)\n    })\n\n    ipcMain.handle('create-prompt-version', async (_event, promptId: number, content: string) => {\n      return await createPromptVersion(this.db!, promptId, content)\n    })\n\n    // Settings handlers\n    ipcMain.handle('get-setting', async (_event, key: string) => {\n      return await getSetting(this.db!, key)\n    })\n\n    ipcMain.handle('set-setting', async (_event, key: string, value: string) => {\n      return await setSetting(this.db!, key, value)\n    })\n\n    // Import/Export handlers\n    ipcMain.handle('export-prompts', async (_event, format: 'json' | 'txt') => {\n      const { filePath } = await dialog.showSaveDialog({\n        filters: format === 'json'\n          ? [{ name: 'JSON Files', extensions: ['json'] }]\n          : [{ name: 'Text Files', extensions: ['txt'] }]\n      })\n\n      if (filePath) {\n        await exportPrompts(this.db!, filePath, format)\n        return { success: true, path: filePath }\n      }\n      return { success: false }\n    })\n\n    ipcMain.handle('import-prompts', async (): Promise<ImportResult> => {\n      const { filePaths } = await dialog.showOpenDialog({\n        filters: [\n          { name: 'Supported Files', extensions: ['json', 'txt'] },\n          { name: 'JSON Files', extensions: ['json'] },\n          { name: 'Text Files', extensions: ['txt'] }\n        ],\n        properties: ['openFile']\n      })\n\n      if (filePaths && filePaths.length > 0) {\n        return await importPrompts(this.db!, filePaths[0])\n      }\n      return { success: false }\n    })\n\n    // Testing handler\n    ipcMain.handle('test-prompt', async (_event, request: ApiTestRequest): Promise<ApiTestResponse> => {\n      try {\n        const { prompt, config } = request\n        const endpoint = config.apiEndpoint || 'https://api.openai.com/v1/chat/completions'\n\n        const startTime = Date.now()\n        const response = await fetch(endpoint, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${config.apiKey}`\n          },\n          body: JSON.stringify({\n            model: config.model,\n            messages: [{ role: 'user', content: prompt }],\n            temperature: config.temperature || 0.7,\n            max_tokens: config.maxTokens\n          })\n        })\n\n        const responseTime = Date.now() - startTime\n        const data = await response.json()\n\n        if (!response.ok) {\n          throw new Error(data.error?.message || 'API request failed')\n        }\n\n        return {\n          success: true,\n          response: data.choices[0].message.content,\n          usage: data.usage,\n          responseTime\n        }\n      } catch (error) {\n        return {\n          success: false,\n          error: error instanceof Error ? error.message : 'Unknown error'\n        }\n      }\n    })\n\n    // MCP Server handlers\n    ipcMain.handle('mcp-server:start', async (_event, config: any, exposedPrompts: any[]) => {\n      console.log('MCP Server start requested', { config, exposedPromptsCount: exposedPrompts?.length })\n      \n      if (!this.mcpServer) {\n        console.error('MCP server not initialized')\n        return { success: false, message: 'MCP server not initialized' }\n      }\n      \n      this.mcpServer.updateConfig(config)\n      this.mcpServer.updateExposedPrompts(exposedPrompts)\n      \n      const result = await this.mcpServer.start()\n      console.log('MCP Server start result:', result)\n      return result\n    })\n\n    ipcMain.handle('mcp-server:stop', async () => {\n      if (!this.mcpServer) {\n        return { success: false, message: 'MCP server not initialized' }\n      }\n      \n      const result = await this.mcpServer.stop()\n      return result\n    })\n\n    ipcMain.handle('mcp-server:status', async () => {\n      if (!this.mcpServer) {\n        return { running: false, message: 'MCP server not initialized' }\n      }\n      \n      return this.mcpServer.getStatus()\n    })\n\n    ipcMain.handle('mcp-server:update-config', async (_event, config: any) => {\n      if (!this.mcpServer) {\n        return { success: false, message: 'MCP server not initialized' }\n      }\n      \n      this.mcpServer.updateConfig(config)\n      return { success: true }\n    })\n\n    ipcMain.handle('mcp-server:update-exposed-prompts', async (_event, exposedPrompts: any[]) => {\n      if (!this.mcpServer) {\n        return { success: false, message: 'MCP server not initialized' }\n      }\n      \n      this.mcpServer.updateExposedPrompts(exposedPrompts)\n      return { success: true }\n    })\n\n    ipcMain.handle('mcp-server:clear-logs', async () => {\n      if (!this.mcpServer) {\n        return { success: false, message: 'MCP server not initialized' }\n      }\n      \n      this.mcpServer.clearLogs()\n      return { success: true }\n    })\n  }\n}\n\n// Initialize the application\nnew PromptStudioApp()"],"names":["app","existsSync","mkdirSync","join","parse","hash","createServer","writeFileSync","readFileSync","extname","basename","BrowserWindow","closeDatabase","Tray","Menu","icon","nativeImage","ipcMain","dialog"],"mappings":"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"}